syntax = "proto3";

message Map {
  required string name = 1;
  required int32 id = 2;

           int64 lastChange = 3; // unix time

  repeated Layer layers = 4;

  message Layer {
    required string name = 1;
    required int32 id = 2;
    required LayerType type = 3 [default = POINTCLOUD2];
             LayerUsageType usageType = 4 [default = LASER];

    enum LayerType {
      POINTCLOUD2 = 0;
      OCTOMAP = 1;
      OPENVDB = 2;
    }
    enum LayerUsageType {
      LASER = 0;
      RADAR = 1;
      NAVIGATION = 2;
      ANNOTATION = 3;
    }
  }
}

message Region {
  required int64 layerId = 1;

  required float minx = 2;
  required float maxx = 3;
  required float miny = 4;
  required float maxy = 5;
  required float minz = 6;
  required float maxz = 7;
  required int32 levelOfDetail = 8;
           bool announce = 9;
           ClipMode clipMode = 10;

  enum ClipMode {
    EXACT = 0;
    SURROUNDING = 1;
  }
}

message RegionData {
  required int64 dataSize = 1;
  // Coded Stream if dataSize > 0
}

message ListMapsRequest {}

service MapService {
  rpc ListMaps (ListMapsRequest) returns (stream Map);
}

service LayerService {
  rpc GetRegion ( Region ) returns (stream RegionData);
}
